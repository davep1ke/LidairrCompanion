<Window x:Class="LidarrCompanion.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:LidarrCompanion"
        xmlns:helpers="clr-namespace:LidarrCompanion.Helpers"
        mc:Ignorable="d"
        Title="Lidarr AI Companion" Height="966" Width="1278">
    <Grid Margin="0,0,0,8" x:Name="mainGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="253*"/>
            <RowDefinition Height="322*"/>
            <RowDefinition Height="367*"/>
        </Grid.RowDefinitions>

        <!-- GRID ROW 0 -->


        <ListView x:Name="list_QueueRecords" Margin="10,41,131,0">
            <!-- Row colouring by Match enum (folders use greens, single-file matches use blues) -->
            <ListView.ItemContainerStyle>
                <Style TargetType="{x:Type ListViewItem}">
                    <Setter Property="Background" Value="Transparent" />
                    <Style.Triggers>
                        <!-- If release has files moved to NotSelectedPath, show brown -->
                        <DataTrigger Binding="{Binding HasNotSelectedMarked}" Value="True">
                            <Setter Property="Background" Value="Brown"/>
                            <Setter Property="Foreground" Value="White"/>
                        </DataTrigger>
                        <!-- Exact match: solid green -->
                        <DataTrigger Binding="{Binding Match}" Value="{x:Static helpers:ReleaseMatchType.Exact}">
                            <Setter Property="Background" Value="Green" />
                        </DataTrigger>
                        <!-- Artist - Album (folder): lighter green -->
                        <DataTrigger Binding="{Binding Match}" Value="{x:Static helpers:ReleaseMatchType.ArtistFirst}">
                            <Setter Property="Background" Value="LightGreen" />
                        </DataTrigger>
                        <!-- Album - Artist (folder): pale green -->
                        <DataTrigger Binding="{Binding Match}" Value="{x:Static helpers:ReleaseMatchType.AlbumFirst}">
                            <Setter Property="Background" Value="PaleGreen" />
                        </DataTrigger>

                        <!-- Single-file matches: blue / lightblue -->
                        <DataTrigger Binding="{Binding Match}" Value="{x:Static helpers:ReleaseMatchType.ArtistFirstFile}">
                            <Setter Property="Background" Value="Blue" />
                            <Setter Property="Foreground" Value="White" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Match}" Value="{x:Static helpers:ReleaseMatchType.AlbumFirstFile}">
                            <Setter Property="Background" Value="LightBlue" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Title" DisplayMemberBinding="{Binding Title}" Width="200"/>
                    <GridViewColumn Header="File Path" DisplayMemberBinding="{Binding OutputPath}" Width="300"/>
                    <GridViewColumn Header="ID" DisplayMemberBinding="{Binding Id}" Width="80"/>
                    <GridViewColumn Header="Download ID" DisplayMemberBinding="{Binding DownloadId}" Width="200"/>
                    <GridViewColumn Header="Matched Artist" DisplayMemberBinding="{Binding MatchedArtist}" Width="200"/>
                </GridView>
            </ListView.View>
        </ListView>

        <!-- Right-side column for Row 0: Grid with top and bottom areas. Top aligns to list_QueueRecords top (59) -->
        <Grid Grid.Row="0" HorizontalAlignment="Right" Width="109" Margin="0,41,10,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Vertical">
                <Button x:Name="btn_GetFilesFromLidarr" Content="Get Next Files" HorizontalAlignment="Left" Margin="0,0,0,6" Width="109" Click="btn_GetFilesFromLidarr_Click" Height="20"/>
                <Button x:Name="btn_GetArtists" Content="Get Artists" Click="btn_GetArtists_Click" Width="109" Height="20" Margin="0,0,0,6"/>
                <Button x:Name="btn_manualReleaseMatchToArtist" Content="Match Artist" Click="btn_manualReleaseMatchToArtist_Click" Width="109" Height="20" Margin="0,0,0,6"/>
                <Button x:Name="btn_autoReleaseMatchToArtist" Content="Auto Match" Click="btn_autoReleaseMatchToArtist_Click" Width="109" Height="20"/>
            </StackPanel>

            <!-- Bottom area currently unused for Row 0 but kept for consistency -->
            <Label Grid.Row="2" x:Name="lbl_artistCount" Content="Get Artists..." Width="109" Height="26" HorizontalContentAlignment="Center" VerticalAlignment="Bottom"/>
        </Grid>

        <Label x:Name="label_Queue" Content="Lidarr Queue Records:" HorizontalAlignment="Left" Margin="10,10,0,0" VerticalAlignment="Top" Width="167" Height="26"/>

        <!-- GRID ROW 1 -->


        <ListView x:Name="list_Files_in_Release" Margin="10,33,0,10" HorizontalAlignment="Left" Width="504" Grid.Row="1" SelectionMode="Extended">
            <ListView.ItemContainerStyle>
                <Style TargetType="{x:Type ListViewItem}">
                    <Style.Setters>
                        <Setter Property="Background" Value="{Binding ProposedActionType, Converter={StaticResource ActionToBackgroundConverter}}"/>
                        <Setter Property="Foreground" Value="{Binding ProposedActionType, Converter={StaticResource ActionToForegroundConverter}}"/>
                    </Style.Setters>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="200"/>
                    <GridViewColumn Header="Path" DisplayMemberBinding="{Binding Path}" Width="250"/>
                </GridView>
            </ListView.View>
        </ListView>

        <ListView x:Name="list_Artist_Releases" Margin="519,33,126,10" SelectionMode="Single" Grid.Row="1">
            <ListView.ItemContainerStyle>
                <Style TargetType="{x:Type ListViewItem}">
                    <Setter Property="Background" Value="Transparent"/>
                    <Style.Triggers>
                        <!-- Pre-matched (hasFile) -> grey so user knows it'll overwrite -->
                        <DataTrigger Binding="{Binding HasFile}" Value="True">
                            <Setter Property="Background" Value="LightGray"/>
                        </DataTrigger>
                        <!-- Other tracks in a release that has assigned tracks -> light blue -->
                        <DataTrigger Binding="{Binding IsReleaseHasAssigned}" Value="True">
                            <Setter Property="Background" Value="LightBlue"/>
                        </DataTrigger>
                        <!-- Assigned (matched) in UI -> light green and disable -->
                        <DataTrigger Binding="{Binding IsAssigned}" Value="True">
                            <Setter Property="Background" Value="LightGreen"/>
                            <Setter Property="IsEnabled" Value="False"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Type" DisplayMemberBinding="{Binding AlbumType}" Width="80"/>
                    <GridViewColumn Header="Release" DisplayMemberBinding="{Binding Release}" Width="250"/>
                    <GridViewColumn Header="Track" DisplayMemberBinding="{Binding Track}" Width="230"/>
                    <GridViewColumn Header="Exists?" Width="50">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding HasFile}" IsEnabled="False" HorizontalAlignment="Center"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Score" Width="80">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Score, StringFormat={}{0:F1}}" HorizontalAlignment="Right"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>

        <!-- Play and open-release folder (left of right column) remain as-is -->
        <Button x:Name="btn_PlayTrack" Content="Play Track" Click="btn_PlayTrack_Click" MouseRightButtonUp="btn_PlayTrack_MouseRightButtonUp" Margin="379,8,0,0" HorizontalAlignment="Left" Width="109" RenderTransformOrigin="0.486,1.097" Grid.Row="1" Height="21" VerticalAlignment="Top"/>
        <Button x:Name="btn_OpenReleaseFolder" Click="btn_OpenReleaseFolder_Click" Margin="493,8,0,0" HorizontalAlignment="Left" Width="21" Grid.Row="1" Height="21" VerticalAlignment="Top">
            <TextBlock Text="📁" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Top"/>
        </Button>

        <Label x:Name="label" Content="Unimported Release Files:" HorizontalAlignment="Left" Margin="10,5,0,0" VerticalAlignment="Top" Width="167" Height="26" Grid.Row="1"/>
        <Label x:Name="label_Copy" Content="Artist Release Files:" HorizontalAlignment="Left" Margin="519,5,0,0" VerticalAlignment="Top" Width="167" Height="26" Grid.Row="1" RenderTransformOrigin="0.5,0.5">
            <Label.RenderTransform>
                <TransformGroup>
                    <ScaleTransform/>
                    <SkewTransform/>
                    <RotateTransform Angle="0.319"/>
                    <TranslateTransform/>
                </TransformGroup>
            </Label.RenderTransform>
        </Label>

        <!-- Right-side column for Row 1: top area aligns to list_Files_in_Release top (33), bottom area contains Clear button bottom-aligned -->
        <Grid Grid.Row="1" HorizontalAlignment="Right" Width="109" Margin="0,33,10,19">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Top controls: align with list_Files_in_Release top -->
            <StackPanel Grid.Row="0" Orientation="Vertical">
                <ComboBox x:Name="cmb_SortMode" SelectionChanged="cmb_SortMode_SelectionChanged" Width="109" Height="23" Margin="0,0,0,6">
                    <ComboBoxItem Content="by Release" />
                    <ComboBoxItem Content="by Track Num" />
                    <ComboBoxItem Content="by Track Name" />
                    <ComboBoxItem Content="by Best" IsSelected="True" />
                </ComboBox>

                <Button x:Name="btn_AI_SearchMatch" Content="AI Match" Margin="0,0,0,6" Click="btn_AI_SearchMatch_Click" Height="20" Width="109" />
            </StackPanel>

            <!-- Bottom controls: bottom aligned inside Grid -->
            <StackPanel Grid.Row="2" Orientation="Vertical" VerticalAlignment="Bottom">
                <Button x:Name="btn_MarkMatch" Content="Mark Match" Click="btn_MarkMatch_Click" Width="109" Height="20" Margin="0,0,0,6"/>

                <Button x:Name="btn_UnlinkFile" Content="Unlink File" Click="btn_UnlinkFile_Click" Width="109" Height="20" Margin="0,0,0,6"/>

                <Button x:Name="btn_DeleteFile" Content="Delete File" Click="btn_DeleteFile_Click" Width="109" Height="20" Margin="0,0,0,6"/>

                <StackPanel Orientation="Horizontal" Width="109" HorizontalAlignment="Left" Margin="0,0,0,6">
                    <Button x:Name="btn_DeferImport" Content="Defer Import" Click="btn_DeferImport_Click" Width="89" Height="21"/>
                    <Button x:Name="btn_OpenDeferFolder" Click="btn_OpenDeferFolder_Click" Width="20" Height="21">
                        <TextBlock Text="📁" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Top"/>
                    </Button>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Width="109" HorizontalAlignment="Right" Margin="0,0,0,6">
                    <Button x:Name="btn_NotForImport" Content="Not For Import" Click="btn_NotForImport_Click" Width="89" Height="21"/>
                    <Button x:Name="btn_OpenNotSelectedFolder" Click="btn_OpenNotSelectedFolder_Click" Width="20" Height="21">
                        <TextBlock Text="📁" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Top"/>
                    </Button>
                </StackPanel>
            </StackPanel>
        </Grid>


        <!-- GRID ROW 2 -->

        <Label x:Name="label_Actions" Content="Actions to Take" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="10,1,0,0" Width="168" Grid.Row="2"/>

        <!-- Proposed actions list: now bound to runtime collection -->
        <ListView x:Name="list_Proposed_Actions" Margin="10,32,131,35" Grid.Row="2">
            <ListView.ItemContainerStyle>
                <Style TargetType="{x:Type ListViewItem}">
                    <Style.Setters>
                        <Setter Property="Background" Value="{Binding Action, Converter={StaticResource ActionToBackgroundConverter}}"/>
                        <Setter Property="Foreground" Value="{Binding Action, Converter={StaticResource ActionToForegroundConverter}}"/>
                    </Style.Setters>
                    <Style.Triggers>
                        <!-- Failed import: highlight red -->
                        <DataTrigger Binding="{Binding IsImportFailed}" Value="True">
                            <Setter Property="Background" Value="Red"/>
                            <Setter Property="Foreground" Value="White"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Type" DisplayMemberBinding="{Binding Action}" Width="110"/>
                    <GridViewColumn Header="FileName" DisplayMemberBinding="{Binding OriginalFileName}" Width="200"/>
                    <GridViewColumn Header="OriginalRelease" DisplayMemberBinding="{Binding OriginalRelease}" Width="200"/>
                    <GridViewColumn Header="MatchedArtist" DisplayMemberBinding="{Binding MatchedArtist}" Width="150"/>
                    <GridViewColumn Header="MatchedTrack" DisplayMemberBinding="{Binding MatchedTrack}" Width="200"/>
                    <GridViewColumn Header="MatchedRelease" DisplayMemberBinding="{Binding MatchedRelease}" Width="250"/>
                </GridView>
            </ListView.View>
        </ListView>

        <!-- Right-side column for Row 2: top area starts at list_Proposed_Actions top (40), bottom area contains Process Actions bottom-aligned -->
        <Grid Grid.Row="2" HorizontalAlignment="Right" Width="109" Margin="0,30,10,35">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Vertical">
                <Button x:Name="btn_UnselectMatch" Content="Unselect" Click="btn_UnselectMatch_Click" Width="109" Height="21" Margin="0,0,0,6"/>
                <Button x:Name="btn_ClearProposed" Content="Clear" Click="btn_ClearProposed_Click" Width="109" Height="21"/>
            </StackPanel>

            <!-- Bottom control: Process Actions -->

            <Button Grid.Row="2" x:Name="btn_Import" Content="Process Actions" Click="btn_Import_Click" Width="109" Height="104"/>
        </Grid>

        <!-- Bottom full-width bar: right-aligned buttons -->
        <Grid Grid.Row="2" VerticalAlignment="Bottom" Margin="0,0,10,6" Height="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                <Button x:Name="btn_CheckOllama" Content="Check Ollama" Click="btn_CheckOllama_Click" Height="20" MinWidth="90"/>
                <Button x:Name="btn_Settings" Content="Settings" Click="btn_Settings_Click" Height="20" MinWidth="60"/>
            </StackPanel>
        </Grid>

        <!-- Status Text at bottom -->
        <TextBlock x:Name="txt_Status" Text="" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="10,0,0,10" Grid.Row="2" Height="16" Width="90" />
    </Grid>
</Window>
